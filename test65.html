<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame Cursor Teleport Component</title>
    <meta name="description" content="Basic example for Cursor Teleport component."></meta>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-cursor-teleport@1.5.0/dist/aframe-cursor-teleport-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>
  </head>
  <body>
    <script>
      AFRAME.registerComponent('spawn-box', {
        init: function () {
          const sphereId = this.el.getAttribute('id');
          const boxId = `box-${sphereId}`;
          this.el.addEventListener('click', () => {
            // Check if the box is already present
            const existingBox = document.getElementById(boxId);
            if (existingBox) {
              existingBox.parentNode.removeChild(existingBox); // Remove the existing box
              return;
            }

            // Create and append a box
            const box = document.createElement('a-box');
            box.setAttribute('id', boxId);
            box.setAttribute('color', 'red');
            box.setAttribute('position', '0 0 0');
            box.setAttribute('scale', '0.001 0.001 0.001'); // Initially set to very small size
            box.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 500; easing: easeInOutQuad'); // Animation to scale up
            box.setAttribute('animation__rotation', 'property: rotation; to: 0 360 0; dur: 3000; loop: true'); // Rotation animation
            this.el.appendChild(box);
          });
        }
      });
    </script>

    <a-scene cursor="rayOrigin: mouse" raycaster="objects: .clickable" renderer="colorManagement: false;">

      <!-- player -->
      <a-entity id="cameraRig" position="0 0 0" cursor-teleport="cameraRig: #cameraRig; cameraHead: #head; collisionEntities: .collision; ignoreEntities: .clickable">
        <a-entity id="head" position="0 1.52 0" camera look-controls="reverseMouseDrag: true"></a-entity>
        <a-entity
          laser-controls="hand: left"
          raycaster="objects: .clickable; far: 100"
          line="color: red; opacity: 0.75"
          blink-controls="
            collisionEntities: .collision;
            cameraRig: #cameraRig;
            teleportOrigin: #head;
            curveShootingSpeed: 6"></a-entity>
        <a-entity
          laser-controls="hand: right"
          raycaster="objects: .clickable"
          line="color: red; opacity: 0.75"
          blink-controls="
            collisionEntities: .collision;
            cameraRig: #cameraRig;
            teleportOrigin: #head;
            curveShootingSpeed: 6"></a-entity>
      </a-entity>

      <!-- scene geometry -->
      <a-assets>
        <a-asset-item id="kokufu" src="https://www.city.echizen.lg.jp/office/030/021/open-data-echizen_d/fil/00101_kokufuhakkutsu.glb"></a-asset-item>
      </a-assets>

      <a-entity gltf-model="#kokufu" scale="1 1 1" position="0 -0.5 0" rotation="0 20 0"></a-entity>

      <a-entity class="collision" position="0 0 0" rotation="-90 0 0" geometry="primitive: plane; width: 18; height: 8" material="color: white; opacity: 0."></a-entity>

      <!-- ui element -->
      <a-entity id="sphere1" class="clickable" spawn-box geometry="primitive: sphere" scale=".1 .1 .1" position="-1 1.2 -1.5" material="color: white"></a-entity>
      <a-entity id="sphere2" class="clickable" spawn-box geometry="primitive: sphere" scale=".1 .1 .1" position="-0 1.2 -1.5" material="color: white"></a-entity>
      <a-entity id="sphere3" class="clickable" spawn-box geometry="primitive: sphere" scale=".1 .1 .1" position="1 1.2 -1.5" material="color: white"></a-entity>

      <a-entity id="destination1" position="3 0 3" rotation="0 0 0"></a-entity>
      <a-entity id="moveup1" class="clickable" geometry="primitive: plane; width: 0.9; height: 0.3" text="value: move directly\non 1st platform; align: center; width: 2" position="0 2 -3.5" rotation="0 0 0" material="color: #000000"></a-entity>

      <a-entity id="destination2" position="8 0 -2.5" rotation="0 135 0"></a-entity>
      <a-entity id="moveup2" class="clickable" geometry="primitive: plane; width: 0.9; height: 0.3" text="value: move directly\non 2nd platform; align: center; width: 2" position="5 2 -3.5" rotation="0 -15 0" material="color: #000000"></a-entity>

      <a-entity id="destination3" position="-8 0 -2.5" rotation="0 -135 0"></a-entity>
      <a-entity id="moveup3" class="clickable" geometry="primitive: plane; width: 0.9; height: 0.3" text="value: move directly\non 3rd platform; align: center; width: 2" position="4 2 3.5" rotation="0 135 0" material="color: #000000"></a-entity>

      <a-entity id="destination4" position="0 0 0" rotation="0 0 0"></a-entity>
      <a-entity id="moveup4" class="clickable" geometry="primitive: plane; width: 0.9; height: 0.3" text="value: return directly\non start platform; align: center; width: 2" position="-4 2 3.5" rotation="0 225 0" material="color: #000000"></a-entity>
    </a-scene>

    <script>
      const cameraRig = document.getElementById('cameraRig');

      // Array to keep track of box visibility for each sphere
      const boxVisibility = [false, false, false];

      for (let i = 1; i <= 3; i++) {
        const sphere = document.getElementById(`sphere${i}`);
        const boxId = `box-sphere${i}`;
        sphere.addEventListener('click', () => {
          // Toggle box visibility for this sphere
          boxVisibility[i - 1] = !boxVisibility[i - 1];
          const box = document.getElementById(boxId);
          if (boxVisibility[i - 1]) {
            if (!box) {
              const newBox = document.createElement('a-box');
              newBox.setAttribute('id', boxId);
              newBox.setAttribute('color', 'red');
              newBox.setAttribute('position', '0 0 0');
              newBox.setAttribute('scale', '0.001 0.001 0.001'); // Initially set to very small size
              newBox.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 500; easing: easeInOutQuad'); // Animation to scale up
              newBox.setAttribute('animation__rotation', 'property: rotation; to: 0 360 0; dur: 3000; loop: true'); // Rotation animation
              sphere.appendChild(newBox);
            }
          } else {
            if (box) {
              box.parentNode.removeChild(box);
            }
          }
        });
      }
    </script>

  </body>
</html>
